<!DOCTYPE html>
<html lang="en">

<head>
    {% include 'inc/header.html.twig' %}
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>

    <title>SQLView - Dashboard</title>
</head>

<body>

{% include 'inc/nav.html.twig' with {'page': 'query'} %}

<div id="wrapper">

    <div class="container">

        <div class="row">
            <div class="col-lg-4">
                <div id="tree">

                </div>
            </div>
            <div class="col-lg-8">
                <pre id="editor" style="height: 120px;">SELECT * FROM users;</pre>

            </div>
        </div>
        <div class="row" style="margin-top:120px;">

            <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">

            </div>

            <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                <button type="button" class="btn btn-primary" style="margin-left:-14px;" id="run_query">Run</button>

                <div class="row" style="margin-top:10px;">

                    <div class="panel panel-default">
                        <div class="panel-body">
                            {% for query in queries %}
                                {{ query.que_string }}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div><!-- /.container -->

</div>
<!-- /#wrapper -->

{% include 'inc/footer.html.twig' %}


<script>
    function getTree() {
        // Some logic to retrieve, or generate tree structure
        return JSON.parse('{{ tree|raw }}');
    }

    $('#tree').treeview({data: getTree()});

    $('#tree').on('nodeSelected', function (event, data) {
        editor.insert(data.column_name)
    });

    $('#run_query').click(function () {

        var formData = {query: editor.getValue()};

        $.ajax({
            url: "/query/run/ajax",
            type: "POST",
            data: formData,
            success: function (data, textStatus, jqXHR) {
//                var data = $.parseJSON(json);

            }
        });


    });


</script>

<script>
    ace.require("ace/ext/language_tools");
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/sql");
    // enable autocompletion and snippets
    editor.setOptions({
        enableBasicAutocompletion: true,
        enableSnippets: true,
        enableLiveAutocompletion: false
    });
    editor.setFontSize(14);
    editor.$blockScrolling = Infinity;
</script>

</body>

</html>
